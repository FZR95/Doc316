<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>面向初学者的物联网全栈开发指南 - 6 - uni-app起步 &mdash; DOC316 v0.1 文档</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="author" title="关于这些文档" href="../../../about.html" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="MQTT 3.1.1 协议" href="../MQTT.html" />
    <link rel="prev" title="面向初学者的物联网全栈开发指南 - 5 - uniCloud对接" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%205%20-.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> DOC316
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">项目</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">IOT</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">面向初学者的物联网全栈开发指南</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%201%20-.html">面向初学者的物联网全栈开发指南 - 1 - 前言与技术路线</a></li>
<li class="toctree-l3"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%202%20-.html">面向初学者的物联网全栈开发指南 - 2 - 硬件侧</a></li>
<li class="toctree-l3"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%203%20-.html">面向初学者的物联网全栈开发指南 - 3 - IOT平台和MQTT协议</a></li>
<li class="toctree-l3"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%204%20-.html">面向初学者的物联网全栈开发指南 - 4 - 硬件侧上云</a></li>
<li class="toctree-l3"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%205%20-.html">面向初学者的物联网全栈开发指南 - 5 - uniCloud对接</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">面向初学者的物联网全栈开发指南 - 6 - uni-app起步</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">1. 准备工具</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2. 项目结构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">3. 页面结构</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../MQTT.html">MQTT 3.1.1 协议</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">欢迎来到DOC316</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DOC316</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">IOT</a> &raquo;</li>
          <li><a href="index.html">面向初学者的物联网全栈开发指南</a> &raquo;</li>
      <li>面向初学者的物联网全栈开发指南 - 6 - uni-app起步</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/projects/IOT/面向初学者的物联网全栈开发指南/面向初学者的物联网全栈开发指南 - 6 -.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="uni-app">
<h1>面向初学者的物联网全栈开发指南 - 6 - uni-app起步<a class="headerlink" href="#uni-app" title="永久链接至标题"></a></h1>
<p>最后，我们要构建一个uni-app，并调用云函数建立起属于自己的全平台客户端，这里只对uni-app做一个简单的介绍，Html，CSS，JS上手比较快，而uni-app在Vue.js的基础上封装了大量的函数，用起来非常方便。</p>
<section id="id1">
<h2>1. 准备工具<a class="headerlink" href="#id1" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>HBuilderX (<a class="reference external" href="https://www.dcloud.io/hbuilderx.html">HBuilderX-高效极客技巧 (dcloud.io)</a>)</p></li>
<li><p>uni-app官方文档：<a class="reference external" href="https://uniapp.dcloud.io/README">什么是 uni-app - uni-app官网 (dcloud.io)</a></p></li>
</ul>
</section>
<section id="id2">
<h2>2. 项目结构<a class="headerlink" href="#id2" title="永久链接至标题"></a></h2>
<p>还是在上一章建立的uni-app中，直接在顶部选择运行，运行到浏览器即可看到当前的项目。uni-app为跨平台项目，运行到浏览器，项目将被编译为H5；运行到小程序模拟器，项目将被编译为对应的小程序；运行到手机或模拟器，项目将被编译为对应的应用程序。</p>
<p><img alt="image-20210827183207888" src="https://raw.githubusercontent.com/FZR95/Pic316/main/image-20210827183207888.png" /></p>
<p>更细致的项目结构请参照文档，在这里只说常用的：</p>
<ul class="simple">
<li><p>pages：在这里右键可以新建页面，页面为.vue格式，一般放置在与页面名相同的文件夹下，index.vue默认为我们的主页（启动页）。</p></li>
<li><p>pages.json：可以配置启动页、页面样式、导航栏等。<a class="reference external" href="https://uniapp.dcloud.io/collocation/pages">pages.json - uni-app官网 (dcloud.io)</a></p></li>
<li><p>static：这里存放所有的静态文件，如示例中的图片。</p></li>
<li><p>manifest.json：项目配置页面。</p></li>
</ul>
</section>
<section id="id3">
<h2>3. 页面结构<a class="headerlink" href="#id3" title="永久链接至标题"></a></h2>
<p>我们打开index.vue，这是这个项目的启动页，他由HTML(&lt;template&gt;)、JavaScript(&lt;script&gt;)和CSS(&lt;style&gt;)构成。</p>
<section id="id4">
<h3>3.1 大体介绍<a class="headerlink" href="#id4" title="永久链接至标题"></a></h3>
<ul class="simple">
<li><p>HTML</p></li>
</ul>
<p>HTML部分非常简单，注意&lt;template&gt;下只能有一个容器&lt;view&gt;存在，里面再包裹页面的所有元素，可以看到里面有一个图片元素&lt;image&gt;和&lt;view&gt;包裹的文字元素&lt;text&gt;。<a class="reference external" href="https://www.runoob.com/html/html-tutorial.html">HTML 教程 | 菜鸟教程 (runoob.com)</a></p>
<ul class="simple">
<li><p>JS</p></li>
</ul>
<p>uni-app基于Vue，因此这一部分与Vue一致，</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;script&gt;
	export default {
		data() {
			return {
                // 此处存放页面声明的变量
				title: &#39;Hello&#39;
			}
		},
		onLoad() {
			// 页面在加载时需要执行的函数和任务 
		},
		methods: {
			// 页面声明的函数
		}
	}
&lt;/script&gt;
</pre></div>
</div>
<p><a class="reference external" href="https://www.runoob.com/js/js-tutorial.html">JavaScript 教程 | 菜鸟教程 (runoob.com)</a></p>
<p><a class="reference external" href="https://cn.vuejs.org/v2/guide/">介绍 — Vue.js (vuejs.org)</a></p>
<ul class="simple">
<li><p>CSS</p></li>
</ul>
<p>此部分请参考教程。<a class="reference external" href="https://www.runoob.com/css/css-tutorial.html">CSS 教程 | 菜鸟教程 (runoob.com)</a></p>
</section>
<section id="html">
<h3>3.2 HTML变量引用<a class="headerlink" href="#html" title="永久链接至标题"></a></h3>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
	<span class="p">&lt;</span><span class="nt">view</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">image</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;logo&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/static/logo.png&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">image</span><span class="p">&gt;</span>
		<span class="p">&lt;</span><span class="nt">view</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-area&quot;</span><span class="p">&gt;</span>
			<span class="p">&lt;</span><span class="nt">text</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>{{title}}<span class="p">&lt;/</span><span class="nt">text</span><span class="p">&gt;</span>
		<span class="p">&lt;/</span><span class="nt">view</span><span class="p">&gt;</span>
	<span class="p">&lt;/</span><span class="nt">view</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>在HTML部分，可以看到文本元素内存在一个{{title}}，像两个大括号“{{}}”这样的形式是用来引用JS中data部分声明的页面变量的，在JS中，可以看到声明了一个title变量，title为字符串类型，值为‘hello’，因此在编译后，原本的“{{title}}”会变为title的值，也即hello。</p>
</section>
<section id="id5">
<h3>3.3 云函数的调用<a class="headerlink" href="#id5" title="永久链接至标题"></a></h3>
<p>下面我们在JS中methods部分声明一个函数，来调用云函数，并将云函数的返回值打印到控制台。</p>
<p>首先在使用其他浏览器通过本项目调用云函数访问其他服务器时，要配置跨域配置，进入<a class="reference external" href="https://unicloud.dcloud.net.cn/home">服务空间 - uniCloud (dcloud.net.cn)</a>，选择项目所在的服务空间，左边栏选择跨域配置，添加域名“iot.cn-shanghai.aliyuncs.com”即可。</p>
<p>先把JS部分添加一个函数IOT_QueryDevice()，通过封装好的函数uniCloud.callFunction()来调用上一章我们创建的名为“QueryDevice”的云函数，使用callback方法，函数调用成功后执行success内的任务，即打印云函数的返回值。<a class="reference external" href="https://uniapp.dcloud.net.cn/uniCloud/cf-functions?id=clientcallfunction">开发云函数 - uni-app官网 (dcloud.net.cn)</a></p>
<p>但是目前这个函数生命好后还没有被页面调用，因此我们在页面加载时执行此函数，也即在onLoad()里调用，这里要特别注意，在Vue.js中，要调用所有在methods中声明的函数和在data中声明的变量，需要为this.xxx的格式，同时要注意在callback异步中的调用方法（即你所使用的封装好的函数使用callback方法，success中的调用）还有所不同，下一节会提到</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;script&gt;
	export default {
		data() {
			return {
				title: &#39;Hello&#39;,
				Devices :[]
			}
		},
		onLoad() {
			this.IOT_QueryDevice()
		},
		methods: {
			IOT_QueryDevice(){
				uniCloud.callFunction({
					name: &#39;QueryDevice&#39;,
					success: (res) =&gt; {
						console.log(res)
					}
				})
			}
		}
	}
&lt;/script&gt;
</pre></div>
</div>
<p>在控制台中，我们看到了云函数返回的数据(result.Data)，</p>
<p><img alt="image-20210827212108809" src="https://raw.githubusercontent.com/FZR95/Pic316/main/image-20210827212108809.png" /></p>
<p>下面我们只取得数组元素DeviceInfo部分即可，也就是</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">DeviceInfo</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p><img alt="image-20210827212323623" src="https://raw.githubusercontent.com/FZR95/Pic316/main/image-20210827212323623.png" /></p>
<p>产品下只有一个设备，所以返回的数组长度为1，第0个元素即我们设备1的详细信息。</p>
</section>
<section id="id6">
<h3>3.3 一个示例<a class="headerlink" href="#id6" title="永久链接至标题"></a></h3>
<p>现在构建一个页面显示产品下所有设备的名字和在线状态，我回到物联网平台多创建了两个设备，通过物联网平台的设备模拟器将他们激活。刷新H5页面，可以看到现在控制台打印出了三个设备，其中device3通过设备模拟器启动，为在线状态。</p>
<p><img alt="image-20210827212847830" src="https://raw.githubusercontent.com/FZR95/Pic316/main/image-20210827212847830.png" /></p>
<p>现在将这个数组赋值到JS中data声明的一个名为Devices的数组里，这里我们提到了刚才的异步调用问题，申明that=this，并在异步函数中改this为that即可。</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span>&lt;script&gt;
	export default {
		data() {
			return {
				title: &#39;Hello&#39;,
				Devices :[]
			}
		},
		onLoad() {
			this.IOT_QueryDevice()
		},
		methods: {
			IOT_QueryDevice(){
				let that = this;
				uniCloud.callFunction({
					name: &#39;QueryDevice&#39;,
					success: (res) =&gt; {
						console.log(res.result.DeviceInfo)
						that.Devices = res.result.DeviceInfo;
					}
				})
				console.log(this.Devices);
			}
		}
	}
&lt;/script&gt;
</pre></div>
</div>
<p>下面在HTML中需要使用Vue的V-for函数，他就是一个便利，将数组中所有元素遍历。v-for的推荐格式如下，其中括号里的item为数组中所遍历到的当前元素替代名，比如我们要引用arr[i].name，遍历到arr[i]元素后，其可替代为item，index为刚才的“i”，为遍历到的元素序号，”in“后面跟的是你需要遍历的数组。最后别忘绑定一个:key。<a class="reference external" href="https://cn.vuejs.org/v2/guide/#%E6%9D%A1%E4%BB%B6%E4%B8%8E%E5%BE%AA%E7%8E%AF">介绍 — Vue.js (vuejs.org)</a></p>
<p>通过刚才控制台的日志，我们知道了返回数据的结构，设备名应该为res.result.DeviceInfo[i].DeviceName，我们将DeviceInfo赋值到Devices，又通过v-for便利元素，因此页面变量调用这里直接写{{item.DeviceName}}即可。</p>
<div class="highlight-vue notranslate"><div class="highlight"><pre><span></span>&lt;template&gt;
	&lt;view class=&quot;content&quot;&gt;
		&lt;view v-for=&quot;(item, index) in Devices&quot; :key=&quot;index&quot;&gt;
			DeviceName:{{item.DeviceName}} , DeviceStatus  : {{item.DeviceStatus}}
		&lt;/view&gt;
	&lt;/view&gt;
&lt;/template&gt;
</pre></div>
</div>
<p>结果展示如图。</p>
<p><img alt="image-20210827213910743" src="https://raw.githubusercontent.com/FZR95/Pic316/main/image-20210827213910743.png" /></p>
<p>至此，从MCU+ESP8266的硬件侧，到IOT云平台+uniCloud的服务侧，再到基于uni-app的跨平台客户端，整个物联网流程讲解完毕，大家可以消化吸收，通过文章给出的大量链接自行拓展学习。整个专栏六篇文章用了两天的时间写完，时间比较紧，如有错误和遗漏，请多多见谅，也请及时批评指出，多多交流。</p>
<p>祝您在物联网的路上旅途愉快！</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="%E9%9D%A2%E5%90%91%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E7%89%A9%E8%81%94%E7%BD%91%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%20-%205%20-.html" class="btn btn-neutral float-left" title="面向初学者的物联网全栈开发指南 - 5 - uniCloud对接" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../MQTT.html" class="btn btn-neutral float-right" title="MQTT 3.1.1 协议" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2022, UJN12J316实验室.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>